import { useState, useEffect } from "react";
import { motion } from "framer-motion";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Search, X } from "lucide-react";
import { Howl } from "howler";
import cocktailData from "@/data/cocktails.json";

export default function Cocktails() {
  const [selectedCocktail, setSelectedCocktail] = useState(null);
  const [search, setSearch] = useState("");
  const [filteredCocktails, setFilteredCocktails] = useState(cocktailData);
  const [recommendation, setRecommendation] = useState(null);

  useEffect(() => {
    if (search) {
      setFilteredCocktails(
        cocktailData.filter((cocktail) =>
          cocktail.name.toLowerCase().includes(search.toLowerCase())
        )
      );
    } else {
      setFilteredCocktails(cocktailData);
    }
  }, [search]);

  useEffect(() => {
    if (filteredCocktails.length) {
      setRecommendation(
        filteredCocktails[Math.floor(Math.random() * filteredCocktails.length)]
      );
    }
  }, [filteredCocktails]);

  const openCocktail = (cocktail) => {
    setSelectedCocktail(cocktail);
    try {
      const sound = new Howl({ src: ["/sounds/shake.mp3"] });
      sound.play();
    } catch (error) {
      console.error("Sound playback error:", error);
    }
  };

  const closeCocktail = (e) => {
    if (!e.target.closest(".modal-content")) {
      setSelectedCocktail(null);
    }
  };

  const surpriseMe = () => {
    if (cocktailData.length > 0) {
      setRecommendation(
        cocktailData[Math.floor(Math.random() * cocktailData.length)]
      );
    }
  };

  return (
    <div className="p-6 bg-gray-900 min-h-screen text-white">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="mb-4 flex items-center gap-2 border-b border-gray-700 pb-2">
        <Search className="text-gray-400" />
        <Input
          type="text"
          placeholder="Search cocktails..."
          value={search}
          onChange={(e) => setSearch(e.target.value)}
          className="bg-gray-800 text-white border-none focus:ring-2 focus:ring-blue-500 rounded-lg px-4 py-2"
        />
      </motion.div>
      <Button onClick={surpriseMe} className="mb-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white py-2 px-6 rounded-lg shadow-lg transform transition hover:scale-105">Surprise Me</Button>
      <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 1 }} className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        {filteredCocktails.map((cocktail) => (
          <motion.div key={cocktail.id} whileHover={{ scale: 1.05 }} className="cursor-pointer" onClick={() => openCocktail(cocktail)}>
            <Card className="bg-gray-800 shadow-lg rounded-2xl overflow-hidden transform transition hover:shadow-xl">
              <img src={cocktail.image || "/default.jpg"} alt={cocktail.name} className="w-full h-48 object-cover transition duration-300 ease-in-out hover:opacity-80" />
              <CardContent className="p-4">
                <h2 className="text-lg font-bold text-center">{cocktail.name}</h2>
              </CardContent>
            </Card>
          </motion.div>
        ))}
      </motion.div>
      {selectedCocktail && (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-6 backdrop-blur-md" onClick={closeCocktail}>
          <motion.div initial={{ scale: 0.8 }} animate={{ scale: 1 }} transition={{ duration: 0.3 }} className="bg-gray-800 p-6 rounded-2xl shadow-xl relative max-w-lg modal-content">
            <button onClick={() => setSelectedCocktail(null)} className="absolute top-3 right-3 text-gray-300 hover:text-white transition">
              <X className="w-6 h-6" />
            </button>
            <img src={selectedCocktail.image || "/default.jpg"} alt={selectedCocktail.name} className="w-full h-48 object-cover rounded-lg shadow-md" />
            <h2 className="text-xl font-bold mt-4 text-center text-white">{selectedCocktail.name}</h2>
            <p className="mt-2 text-gray-300 text-center">{selectedCocktail.description}</p>
            <h3 className="mt-4 font-semibold text-white">Ingredients:</h3>
            <ul className="list-disc list-inside text-gray-400 text-sm">
              {selectedCocktail.ingredients.map((ingredient, index) => (
                <li key={index}>{ingredient}</li>
              ))}
            </ul>
          </motion.div>
        </motion.div>
      )}
      {recommendation && (
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="mt-6 p-4 bg-gray-800 rounded-2xl text-center shadow-lg">
          <h3 className="text-lg font-bold text-white">Recommended for You:</h3>
          <p className="text-gray-400">{recommendation.name}</p>
        </motion.div>
      )}
    </div>
  );
}
